# WB Level 0 Project: Реализация и настройка

## Архитектура и реализация

1. **Чистая архитектура**: Проект реализован с использованием принципов чистой архитектуры, разделяя код на слои:
   - `domain`: Определения основных структур данных (Order, Delivery, Payment, Item)
   - `repository`: Работа с базой данных PostgreSQL и кэшем
   - `service`: Бизнес-логика обработки заказов
   - `delivery`: HTTP-обработчики для API

2. **Кэширование**: Реализован in-memory кэш для быстрого доступа к заказам:
   - `OrderCache` в пакете `cache` использует `sync.Map` для потокобезопасного хранения
   - Методы `Set`, `Get`, `Delete` для работы с кэшем
   - Метод `Restore` для восстановления кэша из базы данных при запуске

3. **Пул соединений с базой данных**:
   ```go
   db.SetMaxOpenConns(10000)
   db.SetMaxIdleConns(500)
   db.SetConnMaxLifetime(5 * time.Minute)
   ```

4. **NATS && JetStream**:
    
   - `Publisher` для отправки заказов в NATS
   - `Subscriber` для получения и обработки заказов из NATS

5. **Валидация данных**: Использование пакета `validator` для проверки структуры заказа, что предотвращает невалидные данные в канале

6. **Логирование**: Использование `slog` для структурированного логирования

7. **Конфигурация**: Использование `viper` для загрузки конфигурации из файла и переменных окружения

8. **API**: REST API с использованием `gorilla/mux` для маршрутизации

9. **Graceful Shutdown**: Реализация корректного завершения работы сервера

## Запуск проекта

### Использование Docker Compose

1. Запуск всех сервисов:
   ```
   docker-compose up -d
   ```

### Использование Makefile

1. Запуск основного приложения:
   ```
   make app
   ```

2. Публикация случайного валидного заказа:
   ```
   make publish
   ```

3. Публикация невалидного заказа:
   ```
   make publish-invalid
   ```

4. Запуск нагрузочного теста:
   ```
   make vegeta-run
   ```
   Вы можете настроить нагрузочное тестирование сами в /vegeta/vegeta.go